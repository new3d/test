(function($){var methods={init:function(options){return this.each(function(){function medium_coors(e,t){var n=1;var r=0,i=0;r=$(t).offset().top;i=$(t).offset().left;if(touchy){e=e.originalEvent;n=e.touches.length;var s=0,o=0;for(var u=0;u<n;u++){s+=e.touches[u].pageX-i;o+=e.touches[u].pageY-r}return[s/n,o/n,n]}else{return[e.pageX-i,e.pageY-r,n]}}var settings={maxZoom:4,zoomIn:"zoom-in.png",zoomOut:"zoom-out.png",reset:false,showControls:true,controlsPos:["left","top"],opacity:.5,sensivity:10,overrideMousewheel:true,mousewheel:true,resetImage:false};if(this.tagName!="IMG"){$.error("Zoomer plugin applies only to img tag.");return false}var $this=$(this);var _this=this;var OLD_SRC=_this.src;if($this.hasClass("ax-zoom")){return}try{eval("var inlineOpts = {"+$(this).attr("title")+"}")}catch(err){}if(options){$.extend(settings,options)}if(typeof inlineOpts!="undefined"){$.extend(settings,inlineOpts)}$this.data("init-status",{parent:$this.parent(),src:$this.attr("src")}).addClass("ax-zoom").css({position:"absolute",top:0,left:0}).data("settings",settings);var MAIN_WIDTH=0;var MAIN_HEIGHT=0;var touchy="ontouchstart"in document.documentElement?true:false;var move="touchmove.axzoomer mousemove.axzoomer";var end="touchend.axzoomer mouseup.axzoomer";var down="touchstart.axzoomer mousedown.axzoomer";var container=$('<div class="ax-container" style="position:relative;overflow:hidden;left:0;top:0;" />').appendTo($this.parent()).show();$this.data("container",container);var controlsDiv=$('<div class="ax-controls"/>').appendTo(container).show().css({"z-index":1e3,position:"absolute",opacity:settings.opacity});var zoomtimer;$this.controlZoom=function(e){$this.zoomInOut(e);zoomtimer=setTimeout(function(){$this.controlZoom(e)},30)};if(settings.zoomIn){var zoomIn=false;if(typeof settings.zoomIn=="string"){zoomIn=$('<img id="zoomInID" src="'+settings.zoomIn+'" alt="+" />').appendTo(controlsDiv).css("cursor","pointer")}else{if(typeof settings.zoomIn=="object"){zoomIn=settings.zoomIn}}if(zoomIn){zoomIn.bind(down,function(e){e.stopPropagation();MOUSEX=MAIN_WIDTH/2;MOUSEY=MAIN_HEIGHT/2;$this.controlZoom(.05)}).bind("dblclick",function(e){e.stopPropagation()}).bind(end+" mouseout",function(){clearTimeout(zoomtimer)})}}if(settings.zoomOut){var zoomOut=false;if(typeof settings.zoomOut=="string"){zoomOut=$('<img id="zoomOutID" src="'+settings.zoomOut+'" alt="-" />').appendTo(controlsDiv).css("cursor","pointer")}else{if(typeof settings.zoomOut=="object"){zoomOut=settings.zoomOut}}if(zoomOut){zoomOut.bind(down,function(e){e.stopPropagation();MOUSEX=MAIN_WIDTH/2;MOUSEY=MAIN_HEIGHT/2;$this.controlZoom(-.05)}).bind("dblclick",function(e){e.stopPropagation()}).bind(end+" mouseout",function(){clearTimeout(zoomtimer)})}}if(settings.reset){var reset=false;if(typeof settings.reset=="string"){reset=$('<img src="'+settings.reset+'" alt="+" />').appendTo(controlsDiv).css("cursor","pointer")}else{if(typeof settings.reset=="object"){reset=settings.reset}}if(reset){reset.bind(down,function(e){e.stopPropagation();MOUSEX=MAIN_WIDTH/2;MOUSEY=MAIN_HEIGHT/2;$this.zoomInOut(-$this.zoomLevel)}).bind("dblclick",function(e){e.stopPropagation()})}}var MAIN_SRC=$this.attr("src");var ZOOM_SRC=$this.attr("src-big");if(settings.srcBig){ZOOM_SRC=settings.srcBig}var imgLoad=new Image;imgLoad.onload=function(){MAIN_WIDTH=_this.width;MAIN_HEIGHT=_this.height;$this.data("dims",{width:MAIN_WIDTH,height:MAIN_HEIGHT});container.css({width:MAIN_WIDTH,height:MAIN_HEIGHT}).append($this);var e=settings.controlsPos[0];var t=settings.controlsPos[1];if(typeof e=="string"){e=e=="right"?MAIN_WIDTH-controlsDiv.width():0}if(typeof t=="string"){t=t=="bottom"?MAIN_HEIGHT-controlsDiv.height():0}controlsDiv.css({left:e,top:t})};imgLoad.src=_this.src;var TOUCHNUM=0;var START_X=0;var START_Y=0;var MOUSEX=0;var MOUSEY=0;var LIMIT_X=0,LIMIT_Y=0;$this.ENABLE_DRAG=false;container.bind(down,function(e){e.preventDefault();var t=medium_coors(e,this);MOUSEX=t[0];MOUSEY=t[1];START_X=_this.offsetLeft-MOUSEX;START_Y=_this.offsetTop-MOUSEY;TOUCHNUM=t[2];if(e.shiftKey){$this.controlZoom(.05)}else{if(e.altKey){$this.controlZoom(-.05)}else{$this.ENABLE_DRAG=true}}}).bind(move,function(e){e.preventDefault();var t=medium_coors(e,this);MOUSEX=t[0];MOUSEY=t[1];TOUCHNUM=t[2];if(TOUCHNUM<=1&&$this.ENABLE_DRAG){$this.drag()}}).bind(end,function(e){$this.ENABLE_DRAG=false;clearTimeout(zoomtimer)}).bind("dblclick",function(e){if(!e.altKey&&!e.shiftKey){var t=medium_coors(e,this);MOUSEX=t[0];MOUSEY=t[1];$this.zoomInOut(1)}}).bind("mousewheel",function(e,t){if(settings.mousewheel){e.preventDefault();if(settings.overrideMousewheel){e.stopPropagation()}$this.zoomInOut(t/settings.sensivity)}});_this.ongesturechange=function(e){e.preventDefault();if(TOUCHNUM>=2){var t=e.scale<1?-1:1;$this.zoomInOut(t/settings.sensivity)}};$(document).bind(end,function(e){$this.ENABLE_DRAG=false;clearTimeout(zoomtimer)});$this.data("ENABLE-AXZ",true);$this.drag=function(){if($this.data("ENABLE-AXZ")!=true){return}var e=MOUSEX+START_X;var t=MOUSEY+START_Y;if(e<=0&&e>=LIMIT_X){$this.css({left:e})}if(t<=0&&t>=LIMIT_Y){$this.css({top:t})}};$this.zoomLevel=1;var timeoutloader;$this.zoomInOut=function(e){if($this.data("ENABLE-AXZ")!=true){return}var t=$this.width()*(1+e);var n=$this.height()*(1+e);if(t<=MAIN_WIDTH){t=MAIN_WIDTH}if(n<=MAIN_HEIGHT){n=MAIN_HEIGHT}var r=t/MAIN_WIDTH;if(r>>0<=settings.maxZoom){$this.zoomLevel=r;LIMIT_X=-MAIN_WIDTH*($this.zoomLevel-1);LIMIT_Y=-MAIN_HEIGHT*($this.zoomLevel-1);var i=e*(_this.offsetLeft-MOUSEX)+_this.offsetLeft;var s=e*(_this.offsetTop-MOUSEY)+_this.offsetTop;if(i<LIMIT_X){i=LIMIT_X}if(i>=0){i=0}if(s<=LIMIT_Y){s=LIMIT_Y}if(s>=0){s=0}$this.css({width:t,height:n,top:s,left:i})}if($this.zoomLevel>1.2&&ZOOM_SRC!=""&&ZOOM_SRC!=null&&ZOOM_SRC!=$this.attr("src")){var o=new Image;o.onload=function(){_this.src=ZOOM_SRC};o.src=ZOOM_SRC}else{if($this.zoomLevel<=1.2&&settings.resetImage&&OLD_SRC!=$this.attr("src")){_this.src=OLD_SRC}}}})},enable:function(){return this.each(function(){var e=$(this);e.data("ENABLE-AXZ",true)})},disable:function(){return this.each(function(){var e=$(this);e.data("ENABLE-AXZ",false)})},destroy:function(){return this.each(function(){var e=$(this);e.removeData("settings").removeClass("ax-zoom");var t=e.data("init-status");var n=e.data("dims");if(typeof n!=="undefined"){e.css({width:n.width,height:n.height}).appendTo(t.parent).attr("src",t.src).data("container").remove()}$(document).unbind(".axzoomer")})},option:function(e,t){return this.each(function(){var n=$(this);var r=n.data("settings");if(t!=null&&t!=undefined){r[e]=t;n.data("settings",r)}else{return r[e]}})}};$.fn.axzoomer=function(e,t){if(methods[e]){return methods[e].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof e==="object"||!e){return methods.init.apply(this,arguments)}else{$.error("Method "+e+" does not exist on jQuery.zoomer3d")}}}})(jQuery)
